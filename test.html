<!DOCTYPE html>
<html lang="zh">
<head></head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rain</title>Mark åŠŸèƒ½æµ‹è¯•</title>
    <style></style>
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }

        .container {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h1 {
            color: #4a6fa5;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-description {
            color: #666;
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 1.5;
        }

        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .test-btn {
            padding: 8px 16px;
            background-color: #4a6fa5;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .test-btn:hover {
            background-color: #6b8cbc;
        }

        .test-btn.secondary {
            background-color: #6c757d;
        }

        .test-btn.secondary:hover {
            background-color: #5a6268;
        }

        .test-btn.success {
            background-color: #28a745;
        }

        .test-btn.success:hover {
            background-color: #218838;
        }

        .test-btn.danger {
            background-color: #dc3545;
        }

        .test-btn.danger:hover {
            background-color: #c82333;
        }

        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            display: none;
        }

        .test-result.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .test-result.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .test-result.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background-color: #28a745;
        }

        .status-offline {
            background-color: #dc3545;
        }

        .status-warning {
            background-color: #ffc107;
        }

        .log-container {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: #f8f9fa;
            font-family: monospace;
            font-size: 12px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px 5px;
            border-bottom: 1px solid #eee;
        }

        .log-time {
            color: #6c757d;
            margin-right: 10px;
        }

        .log-message {
            color: #333;
        }

        .log-error {
            color: #dc3545;
        }

        .log-success {
            color: #28a745;
        }

        .log-info {
            color: #17a2b8;
        }
    </style>
</head>
<body></body>
    <div class="container">
        <h1></h1>RainMark æ™ºèƒ½ä¹¦ç­¾ç®¡ç†æ’ä»¶ - åŠŸèƒ½æµ‹è¯•</h1>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-online"></span>
                æ‰©å±•çŠ¶æ€æ£€æŸ¥
            </div>
            <div class="test-description">
                æ£€æŸ¥ RainMark æ‰©å±•æ˜¯å¦å·²æ­£ç¡®å®‰è£…å¹¶è¿è¡Œ
            </div>
            <div class="test-buttons">
                <button class="test-btn" onclick="testExtensionStatus()">æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
                <button class="test-btn secondary" onclick="testPermissions()">æ£€æŸ¥æƒé™</button>
                <button class="test-btn secondary" onclick="testStorage()">æ£€æŸ¥å­˜å‚¨</button>
            </div>
            <div id="statusResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-warning"></span>
                ä¹¦ç­¾åŠŸèƒ½æµ‹è¯•
            </div>
            <div class="test-description">
                æµ‹è¯•ä¹¦ç­¾çš„åˆ›å»ºã€åˆ†ç±»ã€æœç´¢ç­‰æ ¸å¿ƒåŠŸèƒ½
            </div>
            <div class="test-buttons">
                <button class="test-btn success" onclick="testCreateBookmark()">åˆ›å»ºæµ‹è¯•ä¹¦ç­¾</button>
                <button class="test-btn" onclick="testGetBookmarks()">è·å–æ‰€æœ‰ä¹¦ç­¾</button>
                <button class="test-btn" onclick="testSearchBookmarks()">æœç´¢ä¹¦ç­¾</button>
                <button class="test-btn danger" onclick="testCleanDuplicates()">æ¸…ç†é‡å¤ä¹¦ç­¾</button>
            </div>
            <div id="bookmarkResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-warning"></span>
                æ™ºèƒ½åˆ†ç±»æµ‹è¯•
            </div>
            <div class="test-description">
                æµ‹è¯•æ™ºèƒ½åˆ†ç±»ç®—æ³•çš„å‡†ç¡®æ€§
            </div>
            <div class="test-buttons">
                <button class="test-btn" onclick="testClassification()">æµ‹è¯•åˆ†ç±»ç®—æ³•</button>
                <button class="test-btn secondary" onclick="testAddCustomRule()">æ·»åŠ è‡ªå®šä¹‰è§„åˆ™</button>
                <button class="test-btn secondary" onclick="testGetRules()">æŸ¥çœ‹åˆ†ç±»è§„åˆ™</button>
            </div>
            <div id="classificationResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-warning"></span>
                æ¨èç³»ç»Ÿæµ‹è¯•
            </div>
            <div class="test-description">
                æµ‹è¯•æ™ºèƒ½æ¨èåŠŸèƒ½
            </div>
            <div class="test-buttons">
                <button class="test-btn" onclick="testGetRecommendations()">è·å–æ¨è</button>
                <button class="test-btn secondary" onclick="testSimulateBrowsing()">æ¨¡æ‹Ÿæµè§ˆ</button>
            </div>
            <div id="recommendationResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-warning"></span>
                è®¾ç½®åŠŸèƒ½æµ‹è¯•
            </div>
            <div class="test-description">
                æµ‹è¯•è®¾ç½®ä¿å­˜å’ŒåŠ è½½åŠŸèƒ½
            </div>
            <div class="test-buttons">
                <button class="test-btn" onclick="testSaveSettings()">ä¿å­˜æµ‹è¯•è®¾ç½®</button>
                <button class="test-btn" onclick="testLoadSettings()">åŠ è½½è®¾ç½®</button>
                <button class="test-btn danger" onclick="testResetSettings()">é‡ç½®è®¾ç½®</button>
            </div>
            <div id="settingsResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <span class="status-indicator status-warning"></span>
                ç»¼åˆæµ‹è¯•
            </div>
            <div class="test-description">
                è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶ç”ŸæˆæŠ¥å‘Š
            </div>
            <div class="test-buttons">
                <button class="test-btn success" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
                <button class="test-btn danger" onclick="clearTestData()">æ¸…ç†æµ‹è¯•æ•°æ®</button>
            </div>
            <div id="comprehensiveResult" class="test-result"></div>
        </div>

        <div class="log-container" id="testLog">
            <div class="log-entry">
                <span class="log-time">[ç³»ç»Ÿ]</span>
                <span class="log-info">æµ‹è¯•è„šæœ¬å·²åŠ è½½ï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•</span>
            </div>
        </div>
    </div>

    <script></script>
        let testLog = [];

        function log(message, type = 'info') {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            const logEntry = {
                time: timeStr,
                message: message,
                type: type
            };

            testLog.push(logEntry);

            const logContainer = document.getElementById('testLog');
            const logElement = document.createElement('div');
            logElement.className = 'log-entry';
            logElement.innerHTML = `
                <span class="log-time">[${timeStr}]</span>
                <span class="log-${type}">${message}</span>
            `;

            logContainer.appendChild(logElement);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `test-result ${type}`;
            log(`æµ‹è¯•ç»“æœ: ${message}`, type);
        }

        // æ‰©å±•çŠ¶æ€æ£€æŸ¥
        function testExtensionStatus() {
            log('å¼€å§‹æ£€æŸ¥æ‰©å±•çŠ¶æ€...', 'info');

            if (typeof chrome === 'undefined' || !chrome.runtime) {
                showResult('statusResult', 'âŒ Chromeæ‰©å±•APIä¸å¯ç”¨', 'error');
                return;
            }

            if (!chrome.runtime.id) {
                showResult('statusResult', 'âŒ RainMarkæ‰©å±•æœªå®‰è£…æˆ–æœªå¯ç”¨', 'error');
                return;
            }

            // æ£€æŸ¥æ‰©å±•æ˜¯å¦å“åº”
            chrome.runtime.sendMessage({ action: 'ping' }, (response) => {
                if (chrome.runtime.lastError) {
                    showResult('statusResult', 'âœ… æ‰©å±•å·²å®‰è£…ï¼Œä½†åå°è„šæœ¬æœªè¿è¡Œ', 'warning');
                } else {
                    showResult('statusResult', 'âœ… æ‰©å±•çŠ¶æ€æ­£å¸¸ï¼Œåå°è„šæœ¬è¿è¡Œä¸­', 'success');
                }
            });
        }

        function testPermissions() {
            log('æ£€æŸ¥æ‰©å±•æƒé™...', 'info');

            chrome.permissions.contains({
                permissions: ['bookmarks', 'storage', 'tabs', 'history', 'notifications']
            }, (result) => {
                if (result) {
                    showResult('statusResult', 'âœ… æ‰€æœ‰å¿…è¦æƒé™å·²æˆäºˆ', 'success');
                } else {
                    showResult('statusResult', 'âš ï¸ éƒ¨åˆ†æƒé™æœªæˆäºˆï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½å—é™', 'warning');
                }
            });
        }

        function testStorage() {
            log('æ£€æŸ¥å­˜å‚¨åŠŸèƒ½...', 'info');

            chrome.storage.sync.set({ testKey: 'testValue' }, () => {
                if (chrome.runtime.lastError) {
                    showResult('statusResult', 'âŒ å­˜å‚¨åŠŸèƒ½å¼‚å¸¸: ' + chrome.runtime.lastError.message, 'error');
                } else {
                    chrome.storage.sync.get(['testKey'], (result) => {
                        if (result.testKey === 'testValue') {
                            showResult('statusResult', 'âœ… å­˜å‚¨åŠŸèƒ½æ­£å¸¸', 'success');
                        } else {
                            showResult('statusResult', 'âŒ å­˜å‚¨æ•°æ®ä¸ä¸€è‡´', 'error');
                        }
                    });
                }
            });
        }

        // ä¹¦ç­¾åŠŸèƒ½æµ‹è¯•
        function testCreateBookmark() {
            log('åˆ›å»ºæµ‹è¯•ä¹¦ç­¾...', 'info');

            const testBookmarks = [
                {
                    title: 'GitHub - ä»£ç æ‰˜ç®¡å¹³å°',
                    url: 'https://github.com'
                },
                {
                    title: 'MDN Web Docs - å‰ç«¯å¼€å‘æ–‡æ¡£',
                    url: 'https://developer.mozilla.org'
                },
                {
                    title: 'Stack Overflow - ç¼–ç¨‹é—®ç­”ç¤¾åŒº',
                    url: 'https://stackoverflow.com'
                },
                {
                    title: 'YouTube - è§†é¢‘åˆ†äº«å¹³å°',
                    url: 'https://youtube.com'
                },
                {
                    title: 'Amazon - ç”µå­å•†åŠ¡ç½‘ç«™',
                    url: 'https://amazon.com'
                }
            ];

            let createdCount = 0;
            let errorCount = 0;

            testBookmarks.forEach((bookmark, index) => {
                chrome.bookmarks.create(bookmark, (result) => {
                    if (chrome.runtime.lastError) {
                        errorCount++;
                        log(`åˆ›å»ºä¹¦ç­¾å¤±è´¥: ${bookmark.title} - ${chrome.runtime.lastError.message}`, 'error');
                    } else {
                        createdCount++;
                        log(`åˆ›å»ºä¹¦ç­¾æˆåŠŸ: ${bookmark.title}`, 'success');
                    }

                    if (createdCount + errorCount === testBookmarks.length) {
                        showResult('bookmarkResult',
                            `âœ… åˆ›å»ºå®Œæˆ: ${createdCount}ä¸ªæˆåŠŸ, ${errorCount}ä¸ªå¤±è´¥`,
                            errorCount > 0 ? 'warning' : 'success');
                    }
                });
            });
        }

        function testGetBookmarks() {
            log('è·å–æ‰€æœ‰ä¹¦ç­¾...', 'info');

            chrome.bookmarks.getTree((tree) => {
                if (chrome.runtime.lastError) {
                    showResult('bookmarkResult', 'âŒ è·å–ä¹¦ç­¾å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                let totalCount = 0;
                function countBookmarks(node) {
                    if (node.url) totalCount++;
                    if (node.children) {
                        node.children.forEach(countBookmarks);
                    }
                }

                countBookmarks(tree[0]);
                showResult('bookmarkResult', `âœ… å…±æ‰¾åˆ° ${totalCount} ä¸ªä¹¦ç­¾`, 'success');
                log(`ä¹¦ç­¾æ€»æ•°: ${totalCount}`, 'info');
            });
        }

        function testSearchBookmarks() {
            log('æœç´¢ä¹¦ç­¾æµ‹è¯•...', 'info');

            chrome.bookmarks.search('github', (results) => {
                if (chrome.runtime.lastError) {
                    showResult('bookmarkResult', 'âŒ æœç´¢å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                showResult('bookmarkResult',
                    `âœ… æœç´¢ "github" æ‰¾åˆ° ${results.length} ä¸ªç»“æœ`,
                    'success');
                log(`æœç´¢åˆ° ${results.length} ä¸ªç›¸å…³ä¹¦ç­¾`, 'info');
            });
        }

        function testCleanDuplicates() {
            log('æ¸…ç†é‡å¤ä¹¦ç­¾æµ‹è¯•...', 'info');

            // å‘é€æ¶ˆæ¯ç»™æ‰©å±•è¿›è¡Œæ¸…ç†
            chrome.runtime.sendMessage({ action: 'cleanDuplicates' }, (response) => {
                if (chrome.runtime.lastError) {
                    showResult('bookmarkResult', 'âŒ æ¸…ç†å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                if (response && response.success) {
                    showResult('bookmarkResult',
                        `âœ… æ¸…ç†å®Œæˆï¼Œç§»é™¤äº† ${response.count || 0} ä¸ªé‡å¤ä¹¦ç­¾`,
                        'success');
                } else {
                    showResult('bookmarkResult', 'âŒ æ¸…ç†å¤±è´¥', 'error');
                }
            });
        }

        // æ™ºèƒ½åˆ†ç±»æµ‹è¯•
        function testClassification() {
            log('æµ‹è¯•åˆ†ç±»ç®—æ³•...', 'info');

            const testCases = [
                { title: 'GitHub Repository', url: 'https://github.com/user/repo', expected: 'æŠ€æœ¯' },
                { title: 'React Tutorial', url: 'https://reactjs.org/tutorial', expected: 'å­¦ä¹ ' },
                { title: 'Amazon Shopping', url: 'https://amazon.com/product', expected: 'è´­ç‰©' },
                { title: 'YouTube Music', url: 'https://youtube.com/music', expected: 'å¨±ä¹' },
                { title: 'CNN News', url: 'https://cnn.com/news', expected: 'æ–°é—»' }
            ];

            // å‘é€æ¶ˆæ¯ç»™æ‰©å±•è¿›è¡Œåˆ†ç±»æµ‹è¯•
            chrome.runtime.sendMessage({
                action: 'testClassification',
                testCases: testCases
            }, (response) => {
                if (chrome.runtime.lastError) {
                    showResult('classificationResult', 'âŒ åˆ†ç±»æµ‹è¯•å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                if (response && response.results) {
                    let correct = 0;
                    let total = response.results.length;

                    response.results.forEach((result, index) => {
                        const testCase = testCases[index];
                        if (result.category === testCase.expected) {
                            correct++;
                            log(`åˆ†ç±»æ­£ç¡®: "${testCase.title}" â†’ ${result.category}`, 'success');
                        } else {
                            log(`åˆ†ç±»é”™è¯¯: "${testCase.title}" â†’ ${result.category} (æœŸæœ›: ${testCase.expected})`, 'error');
                        }
                    });

                    const accuracy = Math.round((correct / total) * 100);
                    showResult('classificationResult',
                        `âœ… åˆ†ç±»æµ‹è¯•å®Œæˆ: ${correct}/${total} æ­£ç¡® (${accuracy}%)`,
                        accuracy > 80 ? 'success' : accuracy > 60 ? 'warning' : 'error');
                }
            });
        }

        function testAddCustomRule() {
            log('æ·»åŠ è‡ªå®šä¹‰åˆ†ç±»è§„åˆ™...', 'info');

            chrome.runtime.sendMessage({
                action: 'addClassificationRule',
                pattern: '.*stackoverflow.*',
                category: 'æŠ€æœ¯é—®ç­”'
            }, (response) => {
                if (chrome.runtime.lastError) {
                    showResult('classificationResult', 'âŒ æ·»åŠ è§„åˆ™å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                if (response && response.success) {
                    showResult('classificationResult', 'âœ… è‡ªå®šä¹‰è§„åˆ™æ·»åŠ æˆåŠŸ', 'success');
                } else {
                    showResult('classificationResult', 'âŒ æ·»åŠ è§„åˆ™å¤±è´¥', 'error');
                }
            });
        }

        function testGetRules() {
            log('è·å–åˆ†ç±»è§„åˆ™...', 'info');

            chrome.storage.sync.get(['userClassificationRules'], (result) => {
                if (chrome.runtime.lastError) {
                    showResult('classificationResult', 'âŒ è·å–è§„åˆ™å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                const rules = result.userClassificationRules || [];
                showResult('classificationResult',
                    `âœ… æ‰¾åˆ° ${rules.length} ä¸ªè‡ªå®šä¹‰è§„åˆ™`,
                    'success');
                log(`è‡ªå®šä¹‰è§„åˆ™æ•°é‡: ${rules.length}`, 'info');
            });
        }

        // æ¨èç³»ç»Ÿæµ‹è¯•
        function testGetRecommendations() {
            log('è·å–æ¨èä¹¦ç­¾...', 'info');

            chrome.runtime.sendMessage({ action: 'getRecommendations' }, (response) => {
                if (chrome.runtime.lastError) {
                    showResult('recommendationResult', 'âŒ è·å–æ¨èå¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                if (response && Array.isArray(response)) {
                    showResult('recommendationResult',
                        `âœ… è·å–åˆ° ${response.length} ä¸ªæ¨èä¹¦ç­¾`,
                        'success');
                    log(`æ¨èä¹¦ç­¾æ•°é‡: ${response.length}`, 'info');
                } else {
                    showResult('recommendationResult', 'âŒ æ¨èæ•°æ®æ ¼å¼é”™è¯¯', 'error');
                }
            });
        }

        function testSimulateBrowsing() {
            log('æ¨¡æ‹Ÿæµè§ˆè¡Œä¸º...', 'info');

            // æ¨¡æ‹Ÿè®¿é—®æŠ€æœ¯ç›¸å…³é¡µé¢
            chrome.runtime.sendMessage({
                action: 'simulateBrowsing',
                url: 'https://github.com',
                title: 'GitHub - Where software is built'
            }, (response) => {
                if (chrome.runtime.lastError) {
                    showResult('recommendationResult', 'âŒ æ¨¡æ‹Ÿå¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                if (response && response.success) {
                    showResult('recommendationResult', 'âœ… æµè§ˆè¡Œä¸ºæ¨¡æ‹ŸæˆåŠŸï¼Œæ¨èç³»ç»Ÿå·²æ›´æ–°', 'success');
                } else {
                    showResult('recommendationResult', 'âŒ æ¨¡æ‹Ÿå¤±è´¥', 'error');
                }
            });
        }

        // è®¾ç½®åŠŸèƒ½æµ‹è¯•
        function testSaveSettings() {
            log('ä¿å­˜æµ‹è¯•è®¾ç½®...', 'info');

            const testSettings = {
                autoClassify: true,
                enableNotifications: true,
                enableRecommendations: true,
                checkInvalidBookmarks: true,
                checkFrequency: '60',
                autoCleanDuplicates: false,
                defaultCategory: 'å…¶ä»–',
                testTimestamp: Date.now()
            };

            chrome.storage.sync.set(testSettings, () => {
                if (chrome.runtime.lastError) {
                    showResult('settingsResult', 'âŒ ä¿å­˜è®¾ç½®å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                showResult('settingsResult', 'âœ… æµ‹è¯•è®¾ç½®ä¿å­˜æˆåŠŸ', 'success');
            });
        }

        function testLoadSettings() {
            log('åŠ è½½è®¾ç½®...', 'info');

            chrome.storage.sync.get([
                'autoClassify',
                'enableNotifications',
                'enableRecommendations',
                'checkInvalidBookmarks',
                'checkFrequency',
                'autoCleanDuplicates',
                'defaultCategory'
            ], (result) => {
                if (chrome.runtime.lastError) {
                    showResult('settingsResult', 'âŒ åŠ è½½è®¾ç½®å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                const settingsCount = Object.keys(result).length;
                showResult('settingsResult',
                    `âœ… åŠ è½½åˆ° ${settingsCount} ä¸ªè®¾ç½®é¡¹`,
                    'success');
                log(`è®¾ç½®é¡¹æ•°é‡: ${settingsCount}`, 'info');
            });
        }

        function testResetSettings() {
            log('é‡ç½®è®¾ç½®...', 'info');

            if (!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è®¾ç½®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                return;
            }

            chrome.storage.sync.clear(() => {
                if (chrome.runtime.lastError) {
                    showResult('settingsResult', 'âŒ é‡ç½®è®¾ç½®å¤±è´¥: ' + chrome.runtime.lastError.message, 'error');
                    return;
                }

                showResult('settingsResult', 'âœ… æ‰€æœ‰è®¾ç½®å·²é‡ç½®', 'success');
            });
        }

        // ç»¼åˆæµ‹è¯•
        function runAllTests() {
            log('å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'info');
            showResult('comprehensiveResult', 'ğŸ”„ æµ‹è¯•è¿›è¡Œä¸­ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—...', 'info');

            // æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰æµ‹è¯•
            const tests = [
                testExtensionStatus,
                testPermissions,
                testStorage,
                testGetBookmarks,
                testClassification,
                testGetRecommendations,
                testLoadSettings
            ];

            let currentTest = 0;

            function runNextTest() {
                if (currentTest < tests.length) {
                    log(`è¿è¡Œæµ‹è¯• ${currentTest + 1}/${tests.length}...`, 'info');
                    tests[currentTest]();
                    currentTest++;
                    setTimeout(runNextTest, 1000); // æ¯ä¸ªæµ‹è¯•é—´éš”1ç§’
                } else {
                    showResult('comprehensiveResult', 'âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹ç»“æœ', 'success');
                    log('æ‰€æœ‰æµ‹è¯•å®Œæˆ', 'success');
                }
            }

            runNextTest();
        }

        function clearTestData() {
            log('æ¸…ç†æµ‹è¯•æ•°æ®...', 'info');

            if (!confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®å—ï¼Ÿæ­¤æ“ä½œå°†åˆ é™¤æµ‹è¯•æœŸé—´åˆ›å»ºçš„ä¹¦ç­¾å’Œè®¾ç½®ã€‚')) {
                return;
            }

            // æ¸…ç†æµ‹è¯•ä¹¦ç­¾
            chrome.bookmarks.search('test', (results) => {
                results.forEach((bookmark) => {
                    chrome.bookmarks.remove(bookmark.id);
                });
            });

            // æ¸…ç†æµ‹è¯•è®¾ç½®
            chrome.storage.sync.remove(['testKey', 'testTimestamp']);

            showResult('comprehensiveResult', 'âœ… æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆ', 'success');
            log('æµ‹è¯•æ•°æ®å·²æ¸…ç†', 'success');
        }

        // åˆå§‹åŒ–
        log('RainMark æµ‹è¯•è„šæœ¬åˆå§‹åŒ–å®Œæˆ', 'success');
        log('è¯·ç¡®ä¿ RainMark æ‰©å±•å·²å®‰è£…å¹¶å¯ç”¨', 'info');
        log('ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½', 'info');
    </script>
</body>
</html>
